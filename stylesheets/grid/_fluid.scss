// Compass Box-Sizing
@import "compass/css3/box-sizing";

//-----------------------------------
// Defaults
//-----------------------------------
// output the generic CSS styles
$fluid-grid-css: false !default;

//-----------------------------------
// Column Widths
//-----------------------------------

// apply a width to a column
@mixin fluid-grid($i, $plus: 0, $parent: $columns, $parent-plus: 0) {
  width: fluid-grid-width($i, $plus, $parent, $parent-plus);
}

// return a percentage width relative to columns
@function fluid-grid-width($i, $plus: 0, $parent: $columns, $parent-plus: 0) {
  @return percentage(grid-width($i, $plus) / grid-width($parent, $parent-plus + $gutter-width));
}

// return a percentage width relative to lengths
@function fluid-width($width, $parent-width: grid-width($columns, $gutter-width)) {
  @return percentage($width / $parent-width);
}


//-----------------------------------
// Containers
//-----------------------------------

// specify a container as a page
@mixin fluid-grid-page($i: $columns, $plus: 0) {
  @extend .clearfix;
  @include box-sizing(border-box);
  max-width: grid-width($i, $plus + $gutter-width);
  width: 100%;
  margin: 0 auto;
}

// specify a container as a row
@mixin fluid-grid-row($page: false, $parent: $columns, $parent-plus: 0) {
  @extend .clearfix;
  @include box-sizing(border-box);
  width: auto;
  
  // rows directly inside a page don't need the negative margin
  @if $page {
    margin: 0 0;
  } @else {
    margin: 0 fluid-width(-$gutter-width / 2, grid-width($parent, $parent-plus));
  }
}

//-----------------------------------
// Columns
//-----------------------------------

// specify a column
@mixin fluid-grid-column($i: false, $plus: 0, $parent: $columns, $parent-plus: 0) {
  @include box-sizing(border-box);
  margin: 0 fluid-width($gutter-width / 2, grid-width($parent, $parent-plus + $gutter-width));
  float: left;
  
  // paulirish.com/2008/conditional-stylesheets-vs-css-hacks-answer-neither/
  @if $grid-support-for-ie6 { .ie6 & { display: inline; } }
  
  // apply a width
  @if $i { @include fluid-grid($i, $plus, $parent, $parent-plus); }
}

// alter the margins of a column
@mixin fluid-grid-offset($i: 1, $plus: 0, $side: left, $parent: $columns, $parent-plus: 0) {
  margin-#{$side}: (fluid-grid-width($i, $gutter-width + $plus) + fluid-width($gutter-width / 2, grid-width($parent, $parent-plus + $gutter-width)));
}
@mixin fluid-grid-offset-left($i: 1, $plus: 0, $parent: $columns, $parent-plus: 0) {
  @include fluid-grid-offset($i, $plus, left, $parent, $parent-plus);
}
@mixin fluid-grid-offset-right($i: 1, $plus: 0, $parent: $columns, $parent-plus: 0) {
  @include fluid-grid-offset($i, $plus, right, $parent, $parent-plus);
}

//-----------------------------------
// Default Styles
//-----------------------------------
@if $fluid-grid-css {
  // containers
  .fluid-page {
    @include fluid-grid-page;
  }
  .fluid-row {
    @include fluid-grid-row;
  }
  .fluid-page > .fluid-row {
    @include fluid-grid-row(true);
  }

  // columns
  .fluid-column {
    @include fluid-grid-column;
  }

  @for $i from 1 through $columns {
    // columns widths
    .fluid-grid-#{$i} {
      width: fluid-grid-width($i);
      > .fluid-row { margin: 0 fluid-width(-$gutter-width / 2, grid-width($i)); }
      > .fluid-row > .fluid-column { margin: 0 fluid-width($gutter-width / 2, grid-width($i, $gutter-width)); }
      @for $j from 1 through $columns - 1 {
        @if $j <= $i {
          > .fluid-row > .fluid-grid-#{$j} { width: fluid-grid-width($j, 0, $i); }
        }
        @if $j < $i {
          > .fluid-row > .fluid-before-#{$j} { @include fluid-grid-offset-left($j, 0, $i); }
          > .fluid-row > .fluid-after-#{$j} { @include fluid-grid-offset-right($j, 0, $i); }
        }
      }
    }

    // alter left and right margins
    @if $i < $columns {
      .fluid-before-#{$i} { @include fluid-grid-offset-left($i); }
      .fluid-after-#{$i} { @include fluid-grid-offset-right($i); }
    }
  }

  // Box
  .fluid-box {
    margin-bottom: $gutter-width;
  }
}